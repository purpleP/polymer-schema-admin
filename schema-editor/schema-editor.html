<link rel="import" href="../../components/polymer/polymer.html"/>
<link rel="import" href="../../components/iron-ajax/iron-ajax.html"/>
<link rel="import" href="../../components/paper-input/paper-input.html"/>

<dom-module id="schema-editor">
  <link rel="import" href="schema-editor.css" type="css"> 
  <template>
    <iron-ajax
      id="req"
      auto
      url="test-hyper-schema.json"
      on-response="parseSchema"
      method="GET"
      handle-as="json"
      >
    </iron-ajax>
    <template is="dom-repeat", items="{{props}}" as="property">
      <template is="dom-if", if="{{isNumberProperty(property)}}">
        <paper-input label="{{property.title}}" type="number" value="{{entity[property.name]}}"></paper-input>
      </template>
      <template is="dom-if", if="{{isStringProperty(property)}}">
        <paper-input label="{{property.title}}" type="text"></paper-input>
      </template>
    </template>
    
    
  </template>
  <script>
    Polymer({
      is: 'schema-editor',
      properties: {
        props: {
          type: Array,
          notify: true,
          value: [
            {
              type: "number",
              title: "SomeTitle",
            },
          ],
          observer: 'onPropsChange',
        },
        entity: {
          type: Object,
        },
      },

      parseSchema: function(request) {
        var properties = request.detail.response.properties;
        var names = Object.keys(properties)
        
        this.props = names.map(function(name){
          var obj = properties[name];
          obj.name = name;
          return obj;
        });
      },
      
      isNumberProperty: function(property) {
        return property.type == 'number';
      },
      
      isStringProperty: function(property) {
        return property.type == 'string';
      },

      onPropsChange: function(new_value, old_value) {
        var schemaTypes = {
          number: "number",
          string: "text"
        };
        var inputs = new_value.map(function(prop) {
          var inp = document.createElement('paper-input');
          inp.type = schemaTypes[prop.type];
          inp.value = "{{entity[prop.name]}}";
          inp.label = prop.title;
        });
        for (var i in inputs) {
          Polymer.dom(this.root).appendChild(i);
        };
        console.log(new_value, old_value);
      }
    }); 
  </script>
  
  
</dom-module>

